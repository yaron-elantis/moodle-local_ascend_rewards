{"version":3,"file":"notifications.min.js","sources":["../src/notifications.js"],"sourcesContent":["import Ajax from 'core/ajax';\n\nconst callAjax = (methodname, args) => {\n    const requests = Ajax.call([{methodname, args}]);\n    return requests && requests[0] ? requests[0] : Promise.reject(new Error());\n};\n\nconst setupRewardModal = (onNoMoreBadges) => {\n    const backdrop = document.getElementById('apexRewardBackdrop');\n    const modal = document.getElementById('apexRewardModal');\n    const video = document.getElementById('apexRewardVideo');\n    const fullscreenBtn = document.getElementById('apexRewardFullscreen');\n    const closeBtn = document.getElementById('apexRewardClose');\n\n    if (!backdrop || !modal) {\n        return {exists: false, show: () => {}};\n    }\n\n    let loopCount = 0;\n    const maxLoops = 3;\n\n    const showModal = () => {\n        backdrop.style.display = 'block';\n        modal.style.display = 'block';\n        if (video) {\n            loopCount = 0;\n            video.volume = 0.7;\n            video.currentTime = 0;\n            video.play().catch(() => {});\n        }\n    };\n\n    const closeModal = () => {\n        modal.style.display = 'none';\n        backdrop.style.display = 'none';\n        if (video) {\n            video.pause();\n            video.currentTime = 0;\n            loopCount = 0;\n        }\n        checkForMoreNotifications();\n    };\n\n    const checkForMoreNotifications = () => {\n        callAjax('local_ascend_rewards_check_notifications', {})\n            .then((response) => {\n                if (response.has_more) {\n                    setTimeout(() => {\n                        window.location.reload();\n                    }, 300);\n                } else if (typeof onNoMoreBadges === 'function') {\n                    setTimeout(onNoMoreBadges, 500);\n                }\n            })\n            .catch(() => {});\n    };\n\n    if (video) {\n        video.addEventListener('ended', () => {\n            loopCount += 1;\n            if (loopCount < maxLoops) {\n                video.currentTime = 0;\n                video.play().catch(() => {});\n            }\n        });\n    }\n\n    if (closeBtn) {\n        closeBtn.addEventListener('click', closeModal);\n    }\n    backdrop.addEventListener('click', closeModal);\n\n    if (fullscreenBtn && video) {\n        fullscreenBtn.addEventListener('click', (event) => {\n            event.stopPropagation();\n            if (video.requestFullscreen) {\n                video.requestFullscreen();\n            } else if (video.webkitRequestFullscreen) {\n                video.webkitRequestFullscreen();\n            } else if (video.mozRequestFullScreen) {\n                video.mozRequestFullScreen();\n            } else if (video.msRequestFullscreen) {\n                video.msRequestFullscreen();\n            }\n        });\n    }\n\n    setTimeout(() => {\n        closeModal();\n    }, 25000);\n\n    return {exists: true, show: showModal};\n};\n\nconst setupLevelupModal = () => {\n    const backdrop = document.getElementById('apexLevelupBackdrop');\n    const modal = document.getElementById('apexLevelupModal');\n    const video = document.getElementById('apexLevelupVideo');\n    const sound = document.getElementById('apexLevelupSound');\n    const closeBtn = document.getElementById('apexLevelupClose');\n\n    if (!backdrop || !modal) {\n        return {exists: false, show: () => {}};\n    }\n\n    let loopCount = 0;\n    const maxLoops = 3;\n\n    const showModal = () => {\n        backdrop.style.display = 'block';\n        modal.style.display = 'block';\n        if (video) {\n            loopCount = 0;\n            video.volume = 0.7;\n            video.currentTime = 0;\n            video.play().catch(() => {});\n        }\n        if (sound) {\n            sound.volume = 0.6;\n            sound.currentTime = 0;\n            sound.play().catch(() => {});\n        }\n    };\n\n    const closeModal = () => {\n        modal.style.display = 'none';\n        backdrop.style.display = 'none';\n        if (video) {\n            video.pause();\n            video.currentTime = 0;\n            loopCount = 0;\n        }\n        checkForMoreLevelups();\n    };\n\n    const checkForMoreLevelups = () => {\n        callAjax('local_ascend_rewards_check_levelups', {})\n            .then((response) => {\n                if (response.has_more) {\n                    setTimeout(() => {\n                        window.location.reload();\n                    }, 300);\n                }\n            })\n            .catch(() => {});\n    };\n\n    if (video) {\n        video.addEventListener('ended', () => {\n            loopCount += 1;\n            if (loopCount < maxLoops) {\n                video.currentTime = 0;\n                video.play().catch(() => {});\n            }\n        });\n    }\n\n    if (closeBtn) {\n        closeBtn.addEventListener('click', closeModal);\n    }\n    backdrop.addEventListener('click', closeModal);\n\n    setTimeout(() => {\n        closeModal();\n    }, 25000);\n\n    return {exists: true, show: showModal};\n};\n\nexport const init = () => {\n    const levelup = setupLevelupModal();\n    const reward = setupRewardModal(() => {\n        if (levelup.exists) {\n            levelup.show();\n        }\n    });\n\n    if (reward.exists) {\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => {\n                setTimeout(() => reward.show(), 500);\n            });\n        } else {\n            setTimeout(() => reward.show(), 500);\n        }\n    } else if (levelup.exists) {\n        if (document.readyState === 'loading') {\n            document.addEventListener('DOMContentLoaded', () => {\n                setTimeout(() => levelup.show(), 1000);\n            });\n        } else {\n            setTimeout(() => levelup.show(), 1000);\n        }\n    }\n};\r\n"],"names":["callAjax","methodname","args","requests","Ajax","call","Promise","reject","Error","levelup","backdrop","document","getElementById","modal","video","sound","closeBtn","exists","show","loopCount","closeModal","style","display","pause","currentTime","checkForMoreLevelups","then","response","has_more","setTimeout","window","location","reload","catch","addEventListener","play","volume","setupLevelupModal","reward","onNoMoreBadges","fullscreenBtn","checkForMoreNotifications","event","stopPropagation","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","setupRewardModal","readyState"],"mappings":"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"}