{"version":3,"file":"avatar_modals.min.js","sources":["../src/avatar_modals.js"],"sourcesContent":["/**\n * Avatar, Pet, and Villain Modal Functions\n * Token/Coin unlock system with video previews\n */\n\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\n\nlet modalConfig = {\n    strings: {},\n    urls: {}\n};\n\nconst getString = (key) => {\n    if (!modalConfig || !modalConfig.strings) {\n        return '';\n    }\n    const value = modalConfig.strings[key];\n    return typeof value === 'string' ? value : '';\n};\n\nconst formatString = (template, data = {}) => {\n    if (!template || typeof template !== 'string') {\n        return '';\n    }\n    return template.replace(/\\{(\\w+)\\}/g, (match, key) => {\n        if (Object.prototype.hasOwnProperty.call(data, key)) {\n            return data[key];\n        }\n        return '';\n    });\n};\n\nconst normalizeImageName = (value) => {\n    if (!value) {\n        return '';\n    }\n    const base = String(value).split('/').pop();\n    return base.replace(/\\.png$/i, '');\n};\n\nconst showAlert = (message, isError = false) => {\n    if (!message) {\n        return;\n    }\n    const title = isError ? getString('errorTitle') : getString('alertTitle');\n    const closeLabel = getString('closeLabel');\n    Notification.alert(title || '', message, closeLabel || '');\n};\n\nexport const init = (config = {}) => {\n    if (config && typeof config === 'object') {\n        modalConfig = {\n            strings: {\n                ...modalConfig.strings,\n                ...(config.strings || config)\n            },\n            urls: {\n                ...modalConfig.urls,\n                ...(config.urls || {})\n            }\n        };\n    }\n};\n\n// Modal utility functions.\nvar modalThemeMap = {\n    '#FFD700': 'aa-modal-theme-gold',\n    '#06b6d4': 'aa-modal-theme-cyan',\n    '#ec4899': 'aa-modal-theme-pink',\n    '#FF9500': 'aa-modal-theme-orange',\n    '#dc2626': 'aa-modal-theme-red'\n};\n\nfunction getModalThemeClass(borderColor) {\n    return modalThemeMap[borderColor] || 'aa-modal-theme-gold';\n}\n\nfunction createModal(id, borderColor) {\n    var modal = document.createElement('div');\n    modal.id = id;\n    modal.className = 'aa-modal-backdrop';\n\n    var content = document.createElement('div');\n    content.className = 'aa-modal-content ' + getModalThemeClass(borderColor);\n\n    modal.appendChild(content);\n    return { modal: modal, content: content };\n}\n\nfunction closeModal(modal) {\n    if (document.body.contains(modal)) {\n        document.body.removeChild(modal);\n    }\n}\n\n// Compatibility fallback map for sites where external functions have not been.\n// fully upgraded yet. External services remain the primary path.\nvar legacyEndpointMap = {\n    local_ascend_rewards_avatar_unlock: 'avatar_unlock.php',\n    local_ascend_rewards_pet_unlock: 'pet_unlock.php',\n    local_ascend_rewards_villain_unlock: 'villain_unlock.php'\n};\n\nfunction getAjaxErrorMessage(error, fallbackMessage) {\n    if (!error) {\n        return fallbackMessage;\n    }\n\n    if (typeof error === 'string' && error.trim()) {\n        return error;\n    }\n\n    if (error && typeof error.message === 'string' && error.message.trim()) {\n        return error.message;\n    }\n\n    if (error && typeof error.error === 'string' && error.error.trim()) {\n        return error.error;\n    }\n\n    if (error && error.error && typeof error.error.message === 'string' && error.error.message.trim()) {\n        return error.error.message;\n    }\n\n    if (Array.isArray(error) && error.length > 0) {\n        var first = error[0];\n        if (first && typeof first.message === 'string' && first.message.trim()) {\n            return first.message;\n        }\n    }\n\n    return fallbackMessage;\n}\n\nfunction shouldUseLegacyFallback(error) {\n    var message = getAjaxErrorMessage(error, '').toLowerCase();\n    return message.indexOf('external_functions') !== -1 ||\n        message.indexOf('unknown web service function') !== -1 ||\n        message.indexOf('servicenotavailable') !== -1 ||\n        message.indexOf('method not found') !== -1;\n}\n\nfunction callLegacyAjax(methodname, args) {\n    return new Promise(function (resolve, reject) {\n        var endpoint = legacyEndpointMap[methodname];\n        if (!endpoint) {\n            reject(new Error(getString('ajaxRequestFailed')));\n            return;\n        }\n        if (typeof M === 'undefined' || !M.cfg || !M.cfg.wwwroot) {\n            reject(new Error(getString('ajaxConfigMissing')));\n            return;\n        }\n\n        var payload = [];\n        var safeArgs = args || {};\n        Object.keys(safeArgs).forEach(function (key) {\n            payload.push(encodeURIComponent(key) + '=' + encodeURIComponent(safeArgs[key]));\n        });\n        if (M.cfg.sesskey) {\n            payload.push('sesskey=' + encodeURIComponent(M.cfg.sesskey));\n        }\n\n        var xhr = new XMLHttpRequest();\n        xhr.open('POST', M.cfg.wwwroot + '/local/ascend_rewards/' + endpoint, true);\n        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n\n        xhr.onload = function () {\n            var response = {};\n            try {\n                response = JSON.parse(xhr.responseText || '{}');\n            } catch (parseError) {\n                reject(new Error(getString('ajaxInvalidJson')));\n                return;\n            }\n\n            if (xhr.status >= 200 && xhr.status < 300) {\n                resolve(response);\n            } else {\n                reject(new Error((response && response.error) || getString('ajaxRequestFailed')));\n            }\n        };\n\n        xhr.onerror = function () {\n            reject(new Error(getString('ajaxNetworkError')));\n        };\n\n        xhr.send(payload.join('&'));\n    });\n}\n\nfunction callAscendAjax(methodname, args) {\n    try {\n        var requests = Ajax.call([{methodname: methodname, args: args}]);\n        if (requests && requests[0]) {\n            return requests[0].catch(function (error) {\n                if (shouldUseLegacyFallback(error)) {\n                    return callLegacyAjax(methodname, args);\n                }\n                throw error;\n            });\n        }\n        return Promise.reject(new Error(getString('ajaxRequestFailed')));\n    } catch (err) {\n        return Promise.reject(err);\n    }\n}\n\n// Avatar Unlock Modal (Token Only).\nfunction showAvatarUnlockModal(name, avatar, videoFile, level, tokensAvailable) {\n    if (tokensAvailable <= 0) {\n        showAlert(getString('noTokensAvailable'));\n        return;\n    }\n\n    var elements = createModal('avatarUnlockModal', '#FFD700');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var avatarImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/Avatars/' + avatar;\n\n    content.innerHTML =\n        '<button id=\"avatarModalClose\" class=\"aa-modal-close aa-modal-close--muted\" type=\"button\" aria-label=\"' + getString('closeLabel') + '\"></button>' +\n        '<h2 class=\"aa-modal-title aa-modal-title--sm\">' + formatString(getString('unlockAvatarTitle'), {name: name}) + '</h2>' +\n        '<div class=\"aa-modal-circle\">' +\n        '<img src=\"' + avatarImagePath + '\" class=\"aa-modal-image aa-modal-image--locked\">' +\n        '<div class=\"aa-modal-lock-overlay\">' +\n        '<i class=\"fa-solid fa-lock aa-modal-lock-icon\"></i>' +\n        '</div>' +\n        '</div>' +\n        '<div class=\"aa-modal-note aa-modal-note--muted\">' + formatString(getString('unlockAvatarLevelNote'), {level: level}) + '</div>' +\n        '<button id=\"avatarUnlockConfirm\" class=\"aa-modal-btn aa-modal-btn--accent aa-modal-btn--lg aa-modal-btn--full\" type=\"button\">' + getString('unlockAvatarButton') + '</button>' +\n        '<div class=\"aa-modal-note aa-modal-note--center\">' + getString('unlockAvatarNote') + '</div>';\n\n    document.body.appendChild(modal);\n\n    // Close button.\n    document.getElementById('avatarModalClose').addEventListener('click', function () {\n        closeModal(modal);\n    });\n\n    // Confirm button.\n    document.getElementById('avatarUnlockConfirm').addEventListener('click', function () {\n        this.disabled = true;\n        this.textContent = getString('unlockingLabel');\n\n        callAscendAjax('local_ascend_rewards_avatar_unlock', {avatar: avatar, level: level})\n            .then(function (result) {\n                if (result && result.success) {\n                    closeModal(modal);\n                    showAvatarSuccessModal(name, videoFile);\n                } else {\n                    var errorPrefix = getString('errorPrefix');\n                    var fallbackMessage = getString('errorUnlockAvatar');\n                    var message = (result && (result.error || result.message)) || fallbackMessage;\n                    showAlert('' + errorPrefix + message, true);\n                    closeModal(modal);\n                }\n            })\n            .catch(function (error) {\n                var errorPrefix = getString('errorPrefix');\n                var fallbackMessage = getString('errorUnlockAvatar');\n                showAlert('' + errorPrefix + getAjaxErrorMessage(error, fallbackMessage), true);\n                closeModal(modal);\n            });\n    });\n\n    // Close on backdrop click.\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n        }\n    });\n}\n\n// Avatar Success Modal (shows after unlock).\nfunction showAvatarSuccessModal(name, videoFile, isYouTube = false) {\n    var elements = createModal('avatarSuccessModal', '#06b6d4');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var videoPath = isYouTube\n        ? `https : //www.youtube.com / embed / ${videoFile} ? autoplay = 1 & loop = 1`\n        : M.cfg.wwwroot + '/local/ascend_rewards/pix/Avatars/Videos/' + videoFile;\n\n    var avatarFile = videoFile.replace('.mp4', '.png');\n    var circularImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/Avatars/circular%20avatars/' + avatarFile;\n\n    content.innerHTML =\n        '<button id=\"avatarSuccessClose\" class=\"aa-modal-close aa-modal-close--pink aa-modal-close--grow\" type=\"button\" aria-label=\"' + getString('closeLabel') + '\"></button>' +\n        '<h2 class=\"aa-modal-title\"> ' + formatString(getString('avatarUnlockedTitle'), {name: name}) + '</h2>' +\n        '<div class=\"aa-modal-circle\">' +\n        (isYouTube\n            ? ` < iframe id = \"avatarSuccessVideo\" class = \"aa-modal-iframe\" src = \"${videoPath}\" frameborder = \"0\" allow = \"autoplay; encrypted-media\" allowfullscreen > < / iframe > `\n            : '<video id=\"avatarSuccessVideo\" class=\"aa-modal-video\" autoplay loop>' +\n               '<source src=\"' + videoPath + '\" type=\"video/mp4\">' +\n               '</video>'\n        ) +\n        '</div>' +\n        '<div class=\"aa-modal-info aa-modal-info--pink\">' +\n        '<div class=\"aa-modal-info-title\">' + formatString(getString('avatarPetRevealedTitle'), {name: name}) + '</div>' +\n        '<div class=\"aa-modal-info-text\">' + getString('avatarPetRevealedText') + '</div>' +\n        '</div>' +\n        '<a href=\"' + circularImagePath + '\" download=\"' + name + '_avatar.png\" class=\"aa-modal-btn aa-modal-btn--cyan aa-modal-btn--full\">' + getString('downloadAvatarLabel') + '</a>' +\n        '<div class=\"aa-modal-note aa-modal-note--center\">' + getString('avatarUseProfileNote') + '</div>';\n\n    document.body.appendChild(modal);\n\n    // Set video volume and autoplay for non-YouTube videos.\n    if (!isYouTube) {\n        setTimeout(function () {\n            var video = document.getElementById('avatarSuccessVideo');\n            if (video) {\n                video.volume = 0.7;\n                video.muted = false;\n            }\n        }, 100);\n    }\n\n    // Close button.\n    document.getElementById('avatarSuccessClose').addEventListener('click', function () {\n        closeModal(modal);\n        location.reload(true);\n    });\n\n    // Close on backdrop click.\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n            location.reload(true);\n        }\n    });\n}\n\n// Avatar Review Modal (for already unlocked avatars).\nfunction showAvatarReviewModal(avatarFile, name, videoFile) {\n    var elements = createModal('avatarReviewModal', '#FFD700');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var videoPath = M.cfg.wwwroot + '/local/ascend_rewards/pix/Avatars/Videos/' + videoFile;\n    var circularImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/Avatars/circular%20avatars/' + avatarFile.replace('.png', '.png');\n\n    content.innerHTML =\n        '<button id=\"avatarReviewCloseX\" class=\"aa-modal-close aa-modal-close--muted\" type=\"button\" aria-label=\"' + getString('closeLabel') + '\"></button>' +\n        '<h2 class=\"aa-modal-title\"> ' + name + '</h2>' +\n        '<div class=\"aa-modal-circle\">' +\n        '<video id=\"avatarReviewVideo\" class=\"aa-modal-video\" autoplay loop>' +\n        '<source src=\"' + videoPath + '\" type=\"video/mp4\">' +\n        '</video>' +\n        '</div>' +\n        '<div class=\"aa-modal-info aa-modal-info--pink\">' +\n        '<div class=\"aa-modal-info-title\">' + formatString(getString('avatarPetRevealedTitle'), {name: name}) + '</div>' +\n        '<div class=\"aa-modal-info-text\">' + getString('avatarPetRevealedText') + '</div>' +\n        '</div>' +\n        '<a href=\"' + circularImagePath + '\" download=\"' + name + '_avatar.png\" class=\"aa-modal-btn aa-modal-btn--accent aa-modal-btn--full\">' + getString('downloadAvatarLabel') + '</a>' +\n        '<div class=\"aa-modal-note aa-modal-note--center\">' + getString('avatarUseProfileNote') + '</div>' +\n        '<div class=\"aa-modal-actions\">' +\n        '<button id=\"avatarReviewCloseBtn\" class=\"aa-modal-btn aa-modal-btn--gray aa-modal-btn--sm aa-modal-btn--center\" type=\"button\">' + getString('closeLabel') + '</button>' +\n        '</div>';\n\n    document.body.appendChild(modal);\n\n    // Set video volume and unmute.\n    var video = document.getElementById('avatarReviewVideo');\n    if (video) {\n        video.volume = 0.7;\n        video.muted = false;\n    }\n\n    // Close button.\n    document.getElementById('avatarReviewCloseX').addEventListener('click', function () {\n        closeModal(modal);\n    });\n\n    document.getElementById('avatarReviewCloseBtn').addEventListener('click', function () {\n        closeModal(modal);\n    });\n\n    // Close on backdrop click.\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n        }\n    });\n}\n\n// Pet Unlock Modal (Token OR Coins).\nfunction showPetUnlockModal(petId, petName, price, videoFile, tokensAvailable, userCoins) {\n    var canUseToken = tokensAvailable > 0;\n    var canBuyWithCoins = userCoins >= price;\n\n    // Just show modal regardless - it will display what options are available.\n    var elements = createModal('petUnlockModal', '#ec4899');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    content.innerHTML =\n        '<h2 class=\"aa-modal-title\"> ' + getString('petUnlockTitle') + '</h2>' +\n        '<div class=\"aa-modal-subtitle\">' + petName + '</div>' +\n        '<div class=\"aa-modal-circle aa-modal-circle--lg aa-modal-circle--tint\">' +\n        '<img src=\"' + M.cfg.wwwroot + '/local/ascend_rewards/pix/pets/' + petName.toLowerCase().replace(/\\s/g, '_') + '.png\" alt=\"' + petName + '\" class=\"aa-modal-image aa-modal-image--locked\" onerror=\"this.style.display=\\'none\\'\">' +\n        '<div class=\"aa-modal-lock-overlay\">' +\n        '<i class=\"fa-solid fa-lock aa-modal-lock-icon\"></i>' +\n        '</div>' +\n        '</div>' +\n        '<div class=\"aa-modal-info\">' +\n        '<div class=\"aa-modal-info-title aa-modal-info-title--muted\">' + getString('unlockMethodLabel') + '</div>' +\n        (canUseToken ? '<div class=\"aa-modal-choice aa-modal-choice--gold\"> ' +\n            formatString(getString('tokenAvailableLabel'), {count: tokensAvailable}) +\n            '</div>' : '') +\n        (canBuyWithCoins ? '<div class=\"aa-modal-choice aa-modal-choice--accent\"> ' +\n            formatString(getString('payCoinsLabel'), {price: price.toLocaleString(), balance: userCoins.toLocaleString()}) +\n            '</div>' : '<div class=\"aa-modal-choice aa-modal-choice--error\"> ' +\n            formatString(getString('insufficientCoinsLabel'), {price: price.toLocaleString()}) +\n            '</div>') +\n        '</div>' +\n        '<div class=\"aa-modal-actions\">' +\n        (canUseToken ? '<button class=\"petUnlockToken aa-modal-btn aa-modal-btn--gold aa-modal-btn--action\" type=\"button\"> ' + getString('useTokenButton') + '</button>' : '') +\n        (canBuyWithCoins ? '<button class=\"petUnlockCoins aa-modal-btn aa-modal-btn--accent aa-modal-btn--action\" type=\"button\"> ' +\n            formatString(getString('payButtonLabel'), {price: price.toLocaleString()}) +\n            '</button>' : '') +\n        '<button class=\"petUnlockCancel aa-modal-btn aa-modal-btn--gray aa-modal-btn--action\" type=\"button\">' + getString('cancelLabel') + '</button>' +\n        '</div>';\n\n    // Token unlock handler.\n    if (canUseToken) {\n        var tokenBtn = content.querySelector('.petUnlockToken');\n        if (tokenBtn) {\n            tokenBtn.onclick = function () {\n                this.disabled = true;\n                this.textContent = getString('unlockingLabel');\n                processPetUnlock(petId, 'token', 0, modal, petName, videoFile);\n            };\n        }\n    }\n\n    // Coin unlock handler.\n    if (canBuyWithCoins) {\n        var coinBtn = content.querySelector('.petUnlockCoins');\n        if (coinBtn) {\n            coinBtn.onclick = function () {\n                this.disabled = true;\n                this.textContent = getString('processingLabel');\n                processPetUnlock(petId, 'coin', price, modal, petName, videoFile);\n            };\n        }\n    }\n\n    // Cancel button handler.\n    var cancelBtn = content.querySelector('.petUnlockCancel');\n    if (cancelBtn) {\n        cancelBtn.onclick = function () {\n            closeModal(modal);\n        };\n    }\n\n    // Close on backdrop click.\n    modal.onclick = function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n        }\n    };\n\n    document.body.appendChild(modal);\n}\n\nfunction processPetUnlock(petId, unlockType, price, modal, petName, videoFile) {\n    callAscendAjax('local_ascend_rewards_pet_unlock', {pet_id: petId, unlock_type: unlockType})\n        .then(function (result) {\n            if (result && result.success) {\n                closeModal(modal);\n                showPetSuccessModal(petName, videoFile, unlockType, result.new_balance);\n            } else {\n                var errorPrefix = getString('errorPrefix');\n                var fallbackMessage = getString('errorUnlockPet');\n                var message = (result && (result.error || result.message)) || fallbackMessage;\n                showAlert('' + errorPrefix + message, true);\n                closeModal(modal);\n            }\n        })\n        .catch(function (error) {\n            var errorPrefix = getString('errorPrefix');\n            var fallbackMessage = getString('errorUnlockPet');\n            showAlert('' + errorPrefix + getAjaxErrorMessage(error, fallbackMessage), true);\n            closeModal(modal);\n        });\n}\n\nfunction showPetSuccessModal(petName, videoFile, unlockType, newBalance) {\n    var elements = createModal('petSuccessModal', '#FF9500');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var videoPath = M.cfg.wwwroot + '/local/ascend_rewards/pix/pets/videos/' + videoFile;\n    var downloadImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/pets/pets_circular/' + videoFile.replace('.mp4', '.png');\n\n    var unlockMethodLabel = unlockType === 'token' ? getString('tokenLabel') : getString('coinsLabel');\n\n    content.innerHTML =\n        '<h2 class=\"aa-modal-title\"> ' + getString('petAdoptedTitle') + '</h2>' +\n        '<div class=\"aa-modal-subtitle\">' + petName + '</div>' +\n        '<div class=\"aa-modal-circle\">' +\n        '<video id=\"petSuccessVideo\" class=\"aa-modal-video\" autoplay loop>' +\n        '<source src=\"' + videoPath + '\" type=\"video/mp4\">' +\n        '</video>' +\n        '</div>' +\n        '<div class=\"aa-modal-info aa-modal-info--pink\">' +\n        '<div class=\"aa-modal-info-title\">' + getString('petVillainRevealedTitle') + '</div>' +\n        '<div class=\"aa-modal-info-text\">' + getString('petVillainRevealedText') + '</div>' +\n        '</div>' +\n        '<a href=\"' + downloadImagePath + '\" download=\"' + petName + '_pet.png\" class=\"aa-modal-btn aa-modal-btn--cyan aa-modal-btn--full\">' + getString('downloadPetLabel') + '</a>' +\n        '<div class=\"aa-modal-note aa-modal-note--muted\">' + formatString(getString('unlockedWithLabel'), {method: unlockMethodLabel}) + '</div>' +\n        (unlockType === 'coin'\n            ? '<div class=\"aa-modal-note aa-modal-note--muted\">' +\n                formatString(getString('newBalanceLabel'), {\n                    balance: newBalance.toLocaleString(),\n                    coinsLabel: getString('coinsLabel')\n                }) +\n                '</div>'\n            : '') +\n        '<button id=\"petSuccessClose\" class=\"aa-modal-btn aa-modal-btn--accent aa-modal-btn--center\" type=\"button\">' + getString('continueLabel') + '</button>';\n\n    document.body.appendChild(modal);\n\n    var video = document.getElementById('petSuccessVideo');\n    video.volume = 0.7;\n\n    document.getElementById('petSuccessClose').addEventListener('click', function () {\n        closeModal(modal);\n        location.reload(true);\n    });\n\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n            location.reload(true);\n        }\n    });\n}\n\n// Pet Review Modal.\nfunction showPetReviewModal(petName, petId, videoFile) {\n    var elements = createModal('petReviewModal', '#ec4899');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var videoPath = M.cfg.wwwroot + '/local/ascend_rewards/pix/pets/videos/' + videoFile;\n    var downloadImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/pets/pets_circular/' + videoFile.replace('.mp4', '.png');\n\n    content.innerHTML =\n        '<h2 class=\"aa-modal-title\"> ' + petName + '</h2>' +\n        '<div class=\"aa-modal-circle\">' +\n        '<video id=\"petReviewVideo\" class=\"aa-modal-video\" autoplay loop>' +\n        '<source src=\"' + videoPath + '\" type=\"video/mp4\">' +\n        '</video>' +\n        '</div>' +\n        '<div class=\"aa-modal-info aa-modal-info--pink\">' +\n        '<div class=\"aa-modal-info-title\">' + getString('petVillainRevealedTitle') + '</div>' +\n        '<div class=\"aa-modal-info-text\">' + getString('petVillainRevealedText') + '</div>' +\n        '</div>' +\n        '<a href=\"' + downloadImagePath + '\" download=\"' + petName + '_pet.png\" class=\"aa-modal-btn aa-modal-btn--accent aa-modal-btn--full\">' + getString('downloadPetLabel') + '</a>' +\n        '<div class=\"aa-modal-actions\">' +\n        '<button id=\"petReviewClose\" class=\"aa-modal-btn aa-modal-btn--gray aa-modal-btn--sm aa-modal-btn--center\" type=\"button\">' + getString('closeLabel') + '</button>' +\n        '</div>';\n\n    document.body.appendChild(modal);\n\n    var video = document.getElementById('petReviewVideo');\n    video.volume = 0.7;\n\n    document.getElementById('petReviewClose').addEventListener('click', function () {\n        closeModal(modal);\n    });\n\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n        }\n    });\n}\n\n// Villain Unlock Modal (Token OR Coins).\nfunction showVillainUnlockModal(villainId, villainName, price, villainImageName, villainVideo, tokensAvailable, userCoins) {\n    var canUseToken = tokensAvailable > 0;\n    var canBuyWithCoins = userCoins >= price;\n    var villainImageKey = normalizeImageName(villainImageName);\n\n    // Just show modal regardless - it will display what options are available.\n    var elements = createModal('villainUnlockModal', '#06b6d4');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    content.innerHTML =\n        '<h2 class=\"aa-modal-title\"> ' + getString('villainUnlockTitle') + '</h2>' +\n        '<div class=\"aa-modal-subtitle\">' + villainName + '</div>' +\n        '<div class=\"aa-modal-circle aa-modal-circle--lg aa-modal-circle--tint\">' +\n        '<img src=\"' + M.cfg.wwwroot + '/local/ascend_rewards/pix/villains/' + villainImageKey + '.png\" alt=\"' + villainName + '\" class=\"aa-modal-image aa-modal-image--locked\" onerror=\"this.style.display=\\'none\\'\">' +\n        '<div class=\"aa-modal-lock-overlay\">' +\n        '<i class=\"fa-solid fa-lock aa-modal-lock-icon\"></i>' +\n        '</div>' +\n        '</div>' +\n        '<div class=\"aa-modal-info\">' +\n        '<div class=\"aa-modal-info-title aa-modal-info-title--muted\">' + getString('unlockMethodLabel') + '</div>' +\n        (canUseToken ? '<div class=\"aa-modal-choice aa-modal-choice--gold\"> ' +\n            formatString(getString('tokenAvailableLabel'), {count: tokensAvailable}) +\n            '</div>' : '') +\n        (canBuyWithCoins ? '<div class=\"aa-modal-choice aa-modal-choice--accent\"> ' +\n            formatString(getString('payCoinsLabel'), {price: price.toLocaleString(), balance: userCoins.toLocaleString()}) +\n            '</div>' : '<div class=\"aa-modal-choice aa-modal-choice--error\"> ' +\n            formatString(getString('insufficientCoinsLabel'), {price: price.toLocaleString()}) +\n            '</div>') +\n        '</div>' +\n        '<div class=\"aa-modal-actions\">' +\n        (canUseToken ? '<button class=\"villainUnlockToken aa-modal-btn aa-modal-btn--gold aa-modal-btn--action\" type=\"button\"> ' + getString('useTokenButton') + '</button>' : '') +\n        (canBuyWithCoins ? '<button class=\"villainUnlockCoins aa-modal-btn aa-modal-btn--accent aa-modal-btn--action\" type=\"button\"> ' +\n            formatString(getString('payButtonLabel'), {price: price.toLocaleString()}) +\n            '</button>' : '') +\n        '<button class=\"villainUnlockCancel aa-modal-btn aa-modal-btn--gray aa-modal-btn--action\" type=\"button\">' + getString('cancelLabel') + '</button>' +\n        '</div>';\n    // Token unlock handler.\n    if (canUseToken) {\n        var tokenBtn = content.querySelector('.villainUnlockToken');\n        if (tokenBtn) {\n            tokenBtn.onclick = function () {\n                this.disabled = true;\n                this.textContent = getString('unlockingLabel');\n                processVillainUnlock(villainId, 'token', 0, modal, villainName, villainImageKey, villainVideo);\n            };\n        }\n    }\n\n    // Coin unlock handler.\n    if (canBuyWithCoins) {\n        var coinBtn = content.querySelector('.villainUnlockCoins');\n        if (coinBtn) {\n            coinBtn.onclick = function () {\n                this.disabled = true;\n                this.textContent = getString('processingLabel');\n                processVillainUnlock(villainId, 'coin', price, modal, villainName, villainImageKey, villainVideo);\n            };\n        }\n    }\n\n    // Cancel button handler.\n    var cancelBtn = content.querySelector('.villainUnlockCancel');\n    if (cancelBtn) {\n        cancelBtn.onclick = function () {\n            closeModal(modal);\n        };\n    }\n\n    // Close on backdrop click.\n    modal.onclick = function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n        }\n    };\n\n    document.body.appendChild(modal);\n}\n\nfunction processVillainUnlock(villainId, unlockType, price, modal, villainName, villainImageName, villainVideo) {\n    callAscendAjax('local_ascend_rewards_villain_unlock', {villain_id: villainId, unlock_type: unlockType})\n        .then(function (result) {\n            if (result && result.success) {\n                closeModal(modal);\n                showVillainSuccessModal(villainName, villainImageName, villainVideo, unlockType, result.new_balance);\n            } else {\n                var errorPrefix = getString('errorPrefix');\n                var fallbackMessage = getString('errorUnlockVillain');\n                var message = (result && (result.error || result.message)) || fallbackMessage;\n                showAlert('' + errorPrefix + message, true);\n                closeModal(modal);\n            }\n        })\n        .catch(function (error) {\n            var errorPrefix = getString('errorPrefix');\n            var fallbackMessage = getString('errorUnlockVillain');\n            showAlert('' + errorPrefix + getAjaxErrorMessage(error, fallbackMessage), true);\n            closeModal(modal);\n        });\n}\n\nfunction showVillainSuccessModal(villainName, villainImageName, villainVideo, unlockType, newBalance) {\n    var elements = createModal('villainSuccessModal', '#dc2626');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var villainImageKey = normalizeImageName(villainImageName);\n    var videoPath = M.cfg.wwwroot + '/local/ascend_rewards/pix/villains/videos/' + villainVideo;\n    var downloadImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/villains/villains_circular/' + villainImageKey + '.png';\n\n    var unlockMethodLabel = unlockType === 'token' ? getString('tokenLabel') : getString('coinsLabel');\n\n    content.innerHTML =\n        '<h2 class=\"aa-modal-title\"> ' + getString('villainUnlockedTitle') + '</h2>' +\n        '<div class=\"aa-modal-subtitle\">' + villainName + '</div>' +\n        '<div class=\"aa-modal-circle\">' +\n        '<video id=\"villainSuccessVideo\" class=\"aa-modal-video\" autoplay loop>' +\n        '<source src=\"' + videoPath + '\" type=\"video/mp4\">' +\n        '</video>' +\n        '</div>' +\n        '<div class=\"aa-modal-info aa-modal-info--pink\">' +\n        '<div class=\"aa-modal-info-title\">' + getString('villainStorybookUnlockedTitle') + '</div>' +\n        '<div class=\"aa-modal-info-text\">' + getString('villainStorybookUnlockedText') + '</div>' +\n        '</div>' +\n        '<a href=\"' + downloadImagePath + '\" download=\"' + villainName + '_villain.png\" class=\"aa-modal-btn aa-modal-btn--cyan aa-modal-btn--full\">' + getString('downloadVillainLabel') + '</a>' +\n        '<div class=\"aa-modal-note aa-modal-note--muted\">' + formatString(getString('unlockedWithLabel'), {method: unlockMethodLabel}) + '</div>' +\n        (unlockType === 'coin'\n            ? '<div class=\"aa-modal-note aa-modal-note--muted\">' +\n                formatString(getString('newBalanceLabel'), {\n                    balance: newBalance.toLocaleString(),\n                    coinsLabel: getString('coinsLabel')\n                }) +\n                '</div>'\n            : '') +\n        '<button id=\"villainSuccessClose\" class=\"aa-modal-btn aa-modal-btn--accent aa-modal-btn--center\" type=\"button\">' + getString('continueLabel') + '</button>';\n\n    document.body.appendChild(modal);\n\n    var video = document.getElementById('villainSuccessVideo');\n    video.volume = 0.7;\n\n    document.getElementById('villainSuccessClose').addEventListener('click', function () {\n        closeModal(modal);\n        location.reload(true);\n    });\n\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n            location.reload(true);\n        }\n    });\n}\n\n// Villain Review Modal.\nfunction showVillainReviewModal(villainName, villainId, villainImageName, villainVideo) {\n    var elements = createModal('villainReviewModal', '#06b6d4');\n    var modal = elements.modal;\n    var content = elements.content;\n\n    var villainImageKey = normalizeImageName(villainImageName);\n    var videoPath = M.cfg.wwwroot + '/local/ascend_rewards/pix/villains/videos/' + villainVideo;\n    var downloadImagePath = M.cfg.wwwroot + '/local/ascend_rewards/pix/villains/villains_circular/' + villainImageKey + '.png';\n\n    content.innerHTML =\n        '<h2 class=\"aa-modal-title\"> ' + villainName + '</h2>' +\n        '<div class=\"aa-modal-circle\">' +\n        '<video id=\"villainReviewVideo\" class=\"aa-modal-video\" autoplay loop>' +\n        '<source src=\"' + videoPath + '\" type=\"video/mp4\">' +\n        '</video>' +\n        '</div>' +\n        '<div class=\"aa-modal-info aa-modal-info--pink\">' +\n        '<div class=\"aa-modal-info-title\">' + getString('villainStorybookUnlockedTitle') + '</div>' +\n        '<div class=\"aa-modal-info-text\">' + getString('villainStorybookUnlockedText') + '</div>' +\n        '</div>' +\n        '<a href=\"' + downloadImagePath + '\" download=\"' + villainName + '_villain.png\" class=\"aa-modal-btn aa-modal-btn--accent aa-modal-btn--full\">' + getString('downloadVillainLabel') + '</a>' +\n        '<div class=\"aa-modal-actions\">' +\n        '<button id=\"villainReviewClose\" class=\"aa-modal-btn aa-modal-btn--gray aa-modal-btn--sm aa-modal-btn--center\" type=\"button\">' + getString('closeLabel') + '</button>' +\n        '</div>';\n\n    document.body.appendChild(modal);\n\n    var video = document.getElementById('villainReviewVideo');\n    video.volume = 0.7;\n\n    document.getElementById('villainReviewClose').addEventListener('click', function () {\n        closeModal(modal);\n    });\n\n    modal.addEventListener('click', function (e) {\n        if (e.target === modal) {\n            closeModal(modal);\n        }\n    });\n}\n\nexport {\n    showAvatarUnlockModal,\n    showAvatarReviewModal,\n    showPetUnlockModal,\n    showPetReviewModal,\n    showVillainUnlockModal,\n    showVillainReviewModal,\n    showVillainSuccessModal\n};\n"],"names":["avatarFile","name","videoFile","elements","createModal","modal","content","videoPath","M","cfg","wwwroot","circularImagePath","replace","innerHTML","getString","formatString","document","body","appendChild","video","getElementById","volume","muted","addEventListener","closeModal","e","target","avatar","level","tokensAvailable","showAlert","avatarImagePath","disabled","textContent","callAscendAjax","then","result","success","isYouTube","setTimeout","location","reload","showAvatarSuccessModal","errorPrefix","fallbackMessage","message","error","catch","getAjaxErrorMessage","petName","petId","downloadImagePath","price","userCoins","canUseToken","canBuyWithCoins","toLowerCase","count","toLocaleString","balance","tokenBtn","querySelector","onclick","processPetUnlock","coinBtn","cancelBtn","villainName","villainId","villainImageName","villainVideo","villainImageKey","normalizeImageName","processVillainUnlock","modalConfig","strings","urls","key","value","template","data","match","Object","prototype","hasOwnProperty","call","String","split","pop","isError","title","closeLabel","alert","config","modalThemeMap","id","borderColor","createElement","className","getModalThemeClass","contains","removeChild","legacyEndpointMap","local_ascend_rewards_avatar_unlock","local_ascend_rewards_pet_unlock","local_ascend_rewards_villain_unlock","trim","Array","isArray","length","first","methodname","args","requests","Ajax","indexOf","shouldUseLegacyFallback","Promise","resolve","reject","endpoint","payload","safeArgs","keys","forEach","push","encodeURIComponent","sesskey","xhr","XMLHttpRequest","open","setRequestHeader","onload","response","JSON","parse","responseText","parseError","Error","status","onerror","send","join","callLegacyAjax","err","unlockType","pet_id","unlock_type","newBalance","unlockMethodLabel","method","coinsLabel","showPetSuccessModal","new_balance","villain_id","showVillainSuccessModal"],"mappings":"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"}