define("local_ascend_rewards/admin_dashboard",["exports","core/ajax","core/notification"],(function(_exports,_ajax,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);let ajaxRequestFailed="",alertConfig={alertTitle:"",errorTitle:"",closeLabel:""};const formatString=function(template){let data=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return template&&"string"==typeof template?template.replace(/\{(\w+)\}/g,((match,key)=>Object.prototype.hasOwnProperty.call(data,key)?data[key]:"")):""},showAlert=function(message){let isError=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!message)return;const title=isError?alertConfig.errorTitle:alertConfig.alertTitle;_notification.default.alert(title||"",message,alertConfig.closeLabel||"")},initBadgePreview=config=>{const modal=document.getElementById("apxModal"),backdrop=document.getElementById("apxModalBackdrop"),closeBtn=document.getElementById("apxModalClose"),congratsBanner=document.getElementById("adminAscendCongrats"),congratsVideo=document.getElementById("adminAscendCongratsVideo"),congratsText=document.getElementById("adminAscendCongratsText"),video=document.getElementById("apxRewardVideo"),videoSource=document.getElementById("apxRewardVideoSource"),fullscreenBtn=document.getElementById("apxVideoFullscreen");if(!modal||!backdrop)return;const badgeVideos=(null==config?void 0:config.badgeVideos)||{},badgeCategories=(null==config?void 0:config.badgeCategories)||{},badgeDescriptions=(null==config?void 0:config.badgeDescriptions)||{},knownBadgeNames=(null==config?void 0:config.knownBadgeNames)||[],metaBadgeIds=(null==config?void 0:config.metaBadgeIds)||[],moreActivitiesTemplate=(null==config?void 0:config.moreActivitiesTemplate)||"",badgePreviewFallback=(null==config?void 0:config.badgePreviewFallback)||"",congratsTemplate=(null==config?void 0:config.congratsTemplate)||"",xpLabel=(null==config?void 0:config.xpLabel)||"",assetsLabel=(null==config?void 0:config.assetsLabel)||"",badgeLabel=(null==config?void 0:config.badgeLabel)||"",badgeCategoryDefault=(null==config?void 0:config.badgeCategoryDefault)||"",sampleCourseLabel=(null==config?void 0:config.sampleCourseLabel)||"",selectBadgeAlert=(null==config?void 0:config.selectBadgeAlert)||"",q=selector=>document.querySelector(selector),closeModal=()=>{if(modal.style.display="none",backdrop.style.display="none",document.body.style.overflow="",video&&(video.pause(),video.style.display="none"),congratsBanner&&(congratsBanner.style.display="none"),congratsVideo){congratsVideo.pause();try{congratsVideo.currentTime=0}catch(error){}}},openModal=badgeData=>{const d=badgeData;q("#apxBName").textContent=d.badge||"",q("#apxBCategory").textContent=d.category||badgeCategoryDefault,q("#apxBCourse").textContent=d.course||"",q("#apxBWhen").textContent=d.when||"",q("#apxBWhy").textContent=d.why||"";const coinsText=d.coins||"+0 ".concat(assetsLabel),coins=parseInt(coinsText.match(/\d+/))||0,badgeXp=Math.floor(coins/2);q("#apxBXP").textContent="+".concat(badgeXp," ").concat(xpLabel),q("#apxBCoins").textContent=coinsText;const courseId=parseInt(d.courseid||"0",10),badgeId=parseInt(d.badgeid||"0",10),isMeta=metaBadgeIds.includes(badgeId),activitiesDiv=q("#apxBActivities"),badgesDiv=q("#apxBBadges"),activitiesList=q("#apxBActivitiesList"),badgesList=q("#apxBBadgesList");activitiesDiv&&(activitiesDiv.style.display="none"),badgesDiv&&(badgesDiv.style.display="none"),courseId>0&&!isMeta?((methodname,args)=>{const requests=_ajax.default.call([{methodname:methodname,args:args}]);return requests&&requests[0]?requests[0]:Promise.reject(new Error(ajaxRequestFailed||""))})("local_ascend_rewards_get_activities",{courseid:courseId,badgeid:badgeId}).then((data=>{if(data.activities&&data.activities.length>0){if(data.activities.some((item=>!!knownBadgeNames.includes(item)||knownBadgeNames.some((badgeName=>item.includes(badgeName))))))badgesList&&(badgesList.innerHTML="",data.activities.forEach((badge=>{const li=document.createElement("li");li.textContent=" ".concat(badge),li.style.color="#FFD700",badgesList.appendChild(li)}))),badgesDiv&&(badgesDiv.style.display="block"),activitiesDiv&&(activitiesDiv.style.display="none");else{if(activitiesList&&(activitiesList.innerHTML="",data.activities.forEach(((activity,index)=>{if(index<15){const li=document.createElement("li");li.textContent=" ".concat(activity),li.style.color="#A5B4D6",activitiesList.appendChild(li)}})),data.activities.length>15)){const li=document.createElement("li");li.textContent=formatString(moreActivitiesTemplate,{count:data.activities.length-15}),li.style.color="#FFD700",activitiesList.appendChild(li)}activitiesDiv&&(activitiesDiv.style.display="block"),badgesDiv&&(badgesDiv.style.display="none")}}else activitiesDiv&&(activitiesDiv.style.display="none"),badgesDiv&&(badgesDiv.style.display="none")})).catch((()=>{activitiesDiv&&(activitiesDiv.style.display="none"),badgesDiv&&(badgesDiv.style.display="none")})):(activitiesDiv&&(activitiesDiv.style.display="none"),isMeta&&badgesDiv&&(badgesDiv.style.display="none"));const videoFile=badgeVideos[badgeId]||"reward_animation_2.mp4",videoUrl="".concat(M.cfg.wwwroot,"/local/ascend_rewards/pix/").concat(videoFile);if(video&&videoSource&&(videoSource.src=videoUrl,video.load(),video.style.display="block",video.currentTime=0,video.play().catch((()=>{})),fullscreenBtn&&(fullscreenBtn.style.display="block")),congratsBanner){const badgeName=d.badge||badgeLabel;congratsText.textContent=formatString(congratsTemplate,{badge:badgeName}),congratsBanner.style.display="flex"}if(congratsVideo)try{congratsVideo.currentTime=0,congratsVideo.play()}catch(error){}modal.style.display="block",backdrop.style.display="block",document.body.style.overflow="hidden"};closeBtn&&closeBtn.addEventListener("click",closeModal),backdrop.addEventListener("click",closeModal),fullscreenBtn&&video&&fullscreenBtn.addEventListener("click",(()=>{video.requestFullscreen&&video.requestFullscreen()}));document.querySelectorAll("[data-test-badge-modal]").forEach((btn=>{btn.addEventListener("click",(event=>{event.preventDefault(),(()=>{const badgeSelect=document.getElementById("badgeModalPreviewSelect")||document.getElementById("testBadgeSelect");if(!badgeSelect||!badgeSelect.value)return void showAlert(selectBadgeAlert);const badgeName=(badgeSelect.options[badgeSelect.selectedIndex].text||"").replace(/\s*\([^)]*\)\s*$/,""),badgeId=badgeSelect.value,badgeData={badge:badgeName,category:badgeCategories[badgeId]||badgeCategoryDefault,course:sampleCourseLabel,courseid:1,badgeid:badgeId,when:(new Date).toLocaleDateString(),why:badgeDescriptions[badgeId]||badgePreviewFallback,coins:"+100 ".concat(assetsLabel)};openModal(badgeData)})()}))})),window.openBadgeModal=openModal};_exports.init=config=>{var _window$M,_window$M$cfg;const fallbackConfig=(null===(_window$M=window.M)||void 0===_window$M||null===(_window$M$cfg=_window$M.cfg)||void 0===_window$M$cfg?void 0:_window$M$cfg.local_ascend_rewards_admin_dashboard)||{},resolvedConfig=config&&"object"==typeof config?config:fallbackConfig,alerts=(null==resolvedConfig?void 0:resolvedConfig.alerts)||{};alertConfig={alertTitle:alerts.alertTitle||"",errorTitle:alerts.errorTitle||alerts.alertTitle||"",closeLabel:alerts.closeLabel||""},ajaxRequestFailed=alerts.ajaxRequestFailed||"",initBadgePreview((null==resolvedConfig?void 0:resolvedConfig.badgePreview)||{}),document.querySelectorAll("[data-search-tab]").forEach((btn=>{btn.addEventListener("click",(event=>{event.preventDefault();const tab=btn.getAttribute("data-search-tab");if(!tab)return;const url=new URL(window.location.toString());url.searchParams.set("tab","users"),url.searchParams.set("search_type",tab),url.searchParams.delete("userid"),url.searchParams.delete("badgeid_search"),window.location=url.toString()}))})),(config=>{const awardCourseError=(null==config?void 0:config.awardCourseError)||"",awardBadgeError=(null==config?void 0:config.awardBadgeError)||"",awardForm=document.querySelector("[data-award-form]");awardForm&&awardForm.addEventListener("submit",(event=>{var _document$getElementB,_document$getElementB2;const courseId=(null===(_document$getElementB=document.getElementById("courseid_input"))||void 0===_document$getElementB?void 0:_document$getElementB.value)||"",badgeId=(null===(_document$getElementB2=document.getElementById("badgeid_input"))||void 0===_document$getElementB2?void 0:_document$getElementB2.value)||"",idPattern=/\(\s*[^)]*\d+\s*\)\s*$/;if(!courseId||!idPattern.test(courseId))return showAlert(awardCourseError,!0),void event.preventDefault();badgeId&&idPattern.test(badgeId)||(showAlert(awardBadgeError,!0),event.preventDefault())}))})((null==resolvedConfig?void 0:resolvedConfig.awardForm)||{}),document.querySelectorAll(".aa-admin-chart-bar").forEach((bar=>{const height=parseInt(bar.getAttribute("data-bar-height")||"0",10);!Number.isNaN(height)&&height>0&&(bar.style.height="".concat(height,"px"))}))}}));

//# sourceMappingURL=admin_dashboard.min.js.map